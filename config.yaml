system:
  version: "Stage 28-30 - Full Cognitive Architecture"

ticks:
  light_tick_sec: 5
  heavy_tick_sec: 60

memory:
  episodic_db: "memory/episodes.db"
  semantic_lance: "memory/semantic.lance"
  vector_db: "memory/vector.db"
  max_episodes: 10000

paths:
  state: "memory/state.json"
  snapshots: "memory/snapshots"
  inbox: "inbox.txt"
  outbox: "outbox.txt"

logging:
  level: "INFO"
  dir: "logs"

ollama:
  base_url: "http://127.0.0.1:11434"
  strategy_model: "llama3.2:3b"
  embed_model: "nomic-embed-text"
  timeout_sec: 30
  max_calls_per_tick: 10

# ============================================================
# ðŸš€ NEW: LLM Response Cache (TD-021)
# ============================================================
cache:
  max_size: 100
  ttl_seconds: 300.0

# ============================================================
# ðŸ”’ NEW: Rate Limiting (TD-015, TD-028)
# ============================================================
rate_limit:
  chat_rate: 5.0
  chat_burst: 10
  embed_rate: 20.0
  embed_burst: 50

scores:
  exploration_base: 0.5
  curiosity_base: 0.5
  caution_base: 0.5
  stability_base: 0.5

  thresholds:
    stability_warn: 0.4
    accuracy_warn: 0.4
    growth_warn: 0.3

  modes:
    curious:
      exploration_boost: 0.2
      curiosity_boost: 0.2
    cautious:
      caution_boost: 0.2
      stability_boost: 0.2
    defensive:
      caution_boost: 0.3
      stability_boost: 0.3
      exploration_penalty: -0.3
  drift:
    snapshot_dir: "memory/value_snapshots"
    check_interval_ticks: 168
    drift_threshold: 0.3

strategy:
  weekly_update_hours: 24
  max_now_goals: 5
  max_weekly_goals: 3

resources:
  budget:
    tick_timeout_sec: 30

api:
  enabled: true
  host: "127.0.0.1"
  port: 8766

dream:
  enabled: true
  interval_hours: 6
  insights_limit: 5
  max_insights: 50

emotions:
  decay_rate: 0.1
  min_threshold: 0.05

reflection:
  every_n_ticks: 10
  analyze_last_episodes: 15

narrative:
  every_n_ticks: 15

attention:
  enabled: true
  top_k: 5
  min_score: 0.4
  max_context_chars: 1500
  focus_weights:
    urgency: 0.3
    relevance: 0.3
    emotion: 0.2
    novelty: 0.2

curiosity:
  enabled: true
  ask_every_n_ticks: 20
  answer_every_n_ticks: 15
  max_questions: 100

self_modification:
  enabled: true
  suggest_every_n_ticks: 50
  auto_approve_threshold: 0.8
  max_history: 50

beliefs:
  enabled: true
  form_every_n_ticks: 25
  validate_every_n_ticks: 30
  confidence_threshold: 0.5
  max_beliefs: 100

contradictions:
  enabled: true
  detect_every_n_ticks: 40
  resolve_every_n_ticks: 35
  max_contradictions: 50

shell:
  enabled: true
  allowed_dir: "sandbox"
  max_output_chars: 2000
  timeout_sec: 10
  allowed_commands:
    - "ls"
    - "cat"
    - "pwd"
    - "echo"
    - "date"
    - "wc"
    - "head"
    - "tail"
    - "grep"

time_perception:
  enabled: true
  max_patterns: 50
  min_confidence: 0.4
  detect_every_n_ticks: 40

social:
  enabled: true
  check_inbox_every_tick: true
  initiate_after_ticks: 200

meta_cognition:
  enabled: true
  analyze_every_ticks: 50
  max_insights: 30
  min_confidence: 0.4

skills:
  enabled: true
  extract_every_n_ticks: 30
  min_confidence: 0.6
  max_skills: 200

multi_agent:
  enabled: true
  agent_name: "primary"
  specialization: "general"
  auto_register: true
  
  network:
    host: "localhost"
    port: 9000
  
  shared_storage:
    registry_path: "memory/multi_agent/registry.json"
    message_storage: "memory/multi_agent/messages"
  
  message_processing:
    poll_interval_sec: 2
    batch_size: 10
  
  delegation:
    enabled: true
    auto_delegate_complex: false
    complexity_threshold: 0.7
  
  consensus:
    enabled: true
    default_timeout_sec: 30
  
  skill_sharing:
    enabled: true
    auto_share_new: false
    min_confidence: 0.7
  
  autoscaling:
    enabled: false
    check_interval_sec: 60
    scale_up_threshold: 0.75
    scale_down_threshold: 0.25
    scale_up_cooldown_sec: 300
    scale_down_cooldown_sec: 600
    min_agents_per_type: 1
    max_agents_per_type: 5
    unhealthy_threshold: 3
    heartbeat_timeout_sec: 120
    port_ranges:
      research: [9101, 9150]
      execution: [9201, 9250]
      analysis: [9301, 9350]
      planning: [9401, 9450]
      testing: [9501, 9550]

advanced_multi_agent:
  enabled: false
  
  roles:
    enabled: true
    available_roles:
      - "coordinator"
      - "specialist"
      - "worker"
    auto_assign: true
    reassign_on_failure: true
  
  task_delegation:
    enabled: true
    auto_delegate: false
    selection_strategy: "best_match"
    default_timeout_sec: 120
    max_retries: 2
    priority_weights:
      high: 1.0
      medium: 0.6
      low: 0.3
  
  consensus:
    enabled: true
    quorum_percentage: 0.5
    approval_threshold: 0.6
    use_weighted_voting: true
    auto_resolve: true
    proposal_timeout_sec: 60
    proposal_types:
      - "system_change"
      - "resource_allocation"
      - "task_priority"
      - "agent_action"

longterm_memory:
  enabled: true
  
  consolidation:
    enabled: true
    interval_hours: 2
    importance_weights:
      recency: 0.3
      frequency: 0.25
      emotion: 0.25
      relevance: 0.2
    forgetting_enabled: true
    min_importance: 0.3
    max_memories: 5000
  
  semantic:
    enabled: true
    extract_concepts: true
    min_concept_confidence: 0.6
    max_concepts: 1000
    extract_facts: true
    max_facts: 2000
    build_relationships: true
    min_relationship_strength: 0.4
  
  retrieval:
    enabled: true
    search_levels:
      - "episodic"
      - "semantic"
      - "consolidated"
    cache_enabled: true
    cache_size: 100
    cache_ttl_sec: 300
    ranking_weights:
      relevance: 0.4
      recency: 0.3
      importance: 0.3

# ============================================================
# ðŸ§¬ Stage 30: Self-Evolution (COMPLETE - 8 Components)
# ============================================================
self_evolution:
  enabled: true  # Master switch
  
  # Evolution modes:
  # - supervised: All changes require approval (SAFE for production)
  # - semi_autonomous: Low-risk changes auto-approved
  # - autonomous: Full self-evolution (EXPERIMENTAL)
  mode: "supervised"
  
  # === Component 1: SelfEvolutionManager ===
  manager:
    # Proposal generation
    suggest_changes_every_ticks: 100
    max_pending_proposals: 10
    
    # Change types allowed
    allowed_change_types:
      - "optimization"      # Performance improvements
      - "bug_fix"          # Fix identified issues
      - "feature_addition" # Add new capabilities
      - "refactoring"      # Code cleanup
    
    # Safety requirements
    require_backup: true
    require_testing: true
    require_validation: true
    
    # Approval workflow
    approval:
      timeout_hours: 24
      require_justification: true
      min_confidence: 0.7  # For semi_autonomous mode
  
  # === Component 2: LLMCodeAssistant ===
  llm_code:
    enabled: true
    model: "llama3.2:3b"  # Use configured strategy model
    temperature: 0.7      # Balance creativity vs consistency
    max_tokens: 2000      # Reasonable module size
    
    # Code generation parameters
    generation:
      enforce_docstrings: true
      enforce_type_hints: true
      enforce_error_handling: true
      max_complexity: 15   # McCabe complexity limit
    
    # Quality checks
    quality:
      check_syntax: true
      check_imports: true
      check_style: false   # Requires pylint (optional)
  
  # === Component 3: SafetyValidator ===
  safety:
    enabled: true
    
    # Risk scoring thresholds
    max_risk_score: 0.5   # Block changes above this
    require_approval_above: 0.3  # Human approval needed
    
    # Dangerous patterns (AST-based detection)
    blocked_patterns:
      - "eval"
      - "exec"
      - "compile"
      - "__import__"
      - "open"       # File operations
      - "subprocess" # Shell execution
      - "os.system"
      - "os.remove"
    
    # Import restrictions
    blocked_imports:
      - "subprocess"
      - "shutil"
      - "socket"     # Network operations
      - "requests"
    
    # Code complexity limits
    complexity:
      max_depth: 5         # Max nesting depth
      max_statements: 50   # Max statements per function
      max_branches: 10     # Max if/elif/else branches
  
  # === Component 4: PerformanceMonitor ===
  performance:
    enabled: true
    
    # Metrics to track
    track_metrics:
      - "execution_time"   # Function runtime
      - "memory_usage"     # RAM consumption
      - "cpu_usage"        # CPU utilization
      - "throughput"       # Operations per second
    
    # Regression detection
    regression_threshold: 10.0    # % slowdown = regression
    improvement_threshold: 5.0    # % speedup = improvement
    
    # Benchmarking
    benchmark_iterations: 10      # Runs per measurement
    warmup_iterations: 2          # Discard first N runs
    
    # Historical comparison
    keep_history: true
    max_history_per_module: 50
  
  # === Component 5: AutoRollbackHandler ===
  rollback:
    enabled: true
    
    # Error-based rollback
    error_threshold: 3            # Errors before rollback
    timeout_threshold: 30.0       # Seconds before timeout rollback
    
    # Performance-based rollback
    performance_threshold: 25.0   # % regression triggers rollback
    
    # Health checks
    health_check_interval: 60     # Seconds between checks
    health_check_timeout: 10      # Timeout for health check
    
    # Rollback execution
    auto_rollback: true           # Auto-rollback vs notify
    keep_failed_changes: true     # Save for analysis
  
  # === Component 6: DependencyAnalyzer ===
  dependencies:
    enabled: true
    
    # Analysis scope
    analyze_imports: true
    analyze_function_calls: true
    analyze_class_inheritance: true
    
    # Impact assessment
    calculate_impact: true
    max_depth: 5                  # Dependency tree depth
    
    # Circular dependency detection
    detect_circular: true
    warn_circular: true
    block_circular: false         # Optional: block circular deps
    
    # Risk scoring
    risk_weights:
      dependent_count: 0.4        # More dependents = higher risk
      depth: 0.3                  # Deeper in tree = higher risk
      circular: 0.3               # Circular deps = higher risk
  
  # === Component 7: PriorityQueue ===
  priority_queue:
    enabled: true
    
    # Queue management
    max_queue_size: 100
    default_priority: "normal"    # low | normal | high | critical
    
    # Priority calculation
    priority_weights:
      change_type: 0.3            # bug_fix > optimization
      urgency: 0.3                # critical > low
      risk: 0.2                   # lower risk = higher priority
      impact: 0.2                 # higher impact = higher priority
    
    # Change type priorities
    type_priorities:
      bug_fix: 0.9
      security: 1.0
      optimization: 0.6
      feature_addition: 0.5
      refactoring: 0.4
    
    # Urgency multipliers
    urgency_multipliers:
      critical: 1.5
      high: 1.2
      normal: 1.0
      low: 0.8
    
    # Conflict detection
    detect_conflicts: true        # Check for conflicting changes
    resolve_conflicts: "queue"    # queue | reject | merge
  
  # === Component 8: EvolutionRateLimiter ===
  rate_limits:
    enabled: true
    
    # Time-based limits
    max_per_hour: 5               # Max changes per hour
    max_per_day: 20               # Max changes per day
    min_interval: 300             # Min seconds between changes
    
    # Module-specific cooldowns
    module_cooldown: 600          # 10 min cooldown per module
    
    # Failure backoff (exponential)
    backoff_enabled: true
    backoff_schedule:             # Cooldown after failures
      1: 300    # 1st failure: 5 min
      2: 900    # 2nd failure: 15 min
      3: 1800   # 3rd failure: 30 min
      4: 3600   # 4th failure: 1 hour
      5: 14400  # 5th+ failure: 4 hours
    
    # Burst protection
    burst_window: 300             # 5 min burst window
    max_burst: 3                  # Max changes in burst window
    
    # Override for critical fixes
    allow_override: true          # Manual override possible
    override_requires_approval: true
  
  # === Component 9: CanaryDeployment ===
  canary:
    enabled: true
    
    # Deployment stages
    stages:
      validation:
        duration_sec: 60          # 1 min validation
        traffic_percent: 0
      
      canary:
        duration_sec: 300         # 5 min canary
        traffic_percent: 10
        min_success_rate: 0.95
        max_error_rate: 0.05
      
      pilot:
        duration_sec: 600         # 10 min pilot
        traffic_percent: 30
        min_success_rate: 0.95
        max_error_rate: 0.05
      
      production:
        traffic_percent: 100
    
    # Success criteria (all must pass)
    success_criteria:
      min_success_rate: 0.95      # 95% success required
      max_error_rate: 0.05        # 5% error max
      max_latency_ms: 1000        # 1s max latency
      min_throughput_ratio: 0.9   # 90% of baseline throughput
    
    # Auto-rollback triggers
    auto_rollback:
      on_error_spike: true        # Rollback on sudden errors
      on_latency_spike: true      # Rollback on slow performance
      on_crash: true              # Rollback on crashes
    
    # Metrics collection
    metrics:
      collect_interval_sec: 10    # Sample every 10s
      window_size: 30             # Keep last 30 samples
  
  # === Sandbox & Testing ===
  sandbox:
    enabled: true
    isolated_execution: true
    sandbox_dir: "sandbox/evolution"
    
    # Testing
    run_tests: true
    test_timeout_sec: 30
    require_test_pass: true
    
    # Benchmarking
    benchmark_enabled: true
    benchmark_iterations: 10
    
    # Resource limits
    max_cpu_percent: 50
    max_memory_mb: 512
    max_execution_time_sec: 60
  
  # === History & Backups ===
  history:
    keep_history: true
    max_history_entries: 100
    backup_before_apply: true
    backup_dir: "memory/self_evolution/backups"
    compress_old_backups: true
    max_backup_age_days: 30

# ============================================================
# Advanced Cognitive Features
# ============================================================

consolidation:
  enabled: true
  interval_hours: 24

user_model:
  enabled: true

proactive:
  enabled: true

meta_learning:
  enabled: true
